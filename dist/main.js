!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);i(1);function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(t,i){var n=t.key,o=t.code,a=t.shiftKey,s=void 0===a?null:a,r=t.size,c=void 0===r?null:r,l=t.isControlKey,y=void 0!==l&&l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=null,this.key=n,this.code=o,this.shiftKey=s,this.size=c,this.isControlKey=y,this.language=i,this.isUpperCase=!1,this.init()}var t,i,o;return t=e,(i=[{key:"init",value:function(){this.el=document.createElement("div"),this.el.className="key",this.size&&this.el.classList.add("key_size_".concat(this.size)),this.el.dataset.code=this.code,this.render()}},{key:"render",value:function(){this.shiftKey&&(this.el.dataset.shiftKey=this.shiftKeyLabel),this.el.innerText=this.label}},{key:"setActive",value:function(){var e=this;this.el.classList.add("key_active"),setTimeout((function(){e.el.classList.remove("key_active")}),300)}},{key:"setLanguage",value:function(e){this.language=e,this.render()}},{key:"toggleCase",value:function(){this.isUpperCase=!this.isUpperCase,this.render()}},{key:"label",get:function(){var e=this.key.ru&&this.key.en?this.key[this.language]:this.key;return this.isUpperCase&&!this.isControlKey?e.toUpperCase():e}},{key:"shiftKeyLabel",get:function(){return this.shiftKey.ru&&this.shiftKey.en?this.shiftKey[this.language]:this.shiftKey}}])&&n(t.prototype,i),o&&n(t,o),e}();function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.language="ru",this.altKeyClicked=!1,this.shiftKeyClicked=!1,this.keyboardTemplate=t,this.el=null,this.field=null,this.keys=[]}var t,i,n;return t=e,(i=[{key:"init",value:function(){var e=this;localStorage.getItem("language")?this.language=localStorage.getItem("language"):localStorage.setItem("language",this.language),this.render(),document.addEventListener("click",(function(t){var i=e.keys.find((function(e){return e.el===t.target}));i&&("Shift"===i.key&&(e.altKeyClicked&&e.changeLanguage(),e.shiftKeyClicked=!e.shiftKeyClicked,e.toggleCapsLock()),e.triggerKey(i,t),"Alt"!==i.key&&e.altKeyClicked&&(e.altKeyClicked=!1),"Shift"!==i.key&&e.shiftKeyClicked&&(e.shiftKeyClicked=!1,e.toggleCapsLock()))})),document.addEventListener("keyup",(function(t){var i=e.keys.find((function(e){return e.code===t.code}));i&&e.triggerKey(i,t)}))}},{key:"render",value:function(){var e=this;this.field=document.createElement("textarea"),this.field.className="field",this.field.disabled="disabled",document.body.append(this.field),this.el=document.createElement("div"),this.el.className="keyboard",this.keyboardTemplate.forEach((function(t,i){t.forEach((function(t){var n=new o(t,e.language);n.el.classList.add("key_row_".concat(i+1)),e.el.append(n.el),e.keys.push(n)}))})),document.body.append(this.el)}},{key:"changeLanguage",value:function(){var e=this;this.language="ru"===this.language?"en":"ru",localStorage.setItem("language",this.language),this.keys.forEach((function(t){return t.setLanguage(e.language)}))}},{key:"toggleCapsLock",value:function(){this.keys.forEach((function(e){return e.toggleCase()}))}},{key:"triggerKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(this.field.blur(),e.setActive(),e.code){case"Backspace":this.field.value=this.field.value.slice(0,-1);break;case"CapsLock":this.toggleCapsLock();break;case"Enter":this.field.value+="\n";break;case"Space":this.field.value+=" ";break;case"AltLeft":case"AltRight":t.shiftKey?this.changeLanguage():this.altKeyClicked=!0;break;case"Tab":case"Delete":case"MetaLeft":case"MetaRight":case"ShiftLeft":case"ShiftRight":case"ControlLeft":case"ControlRight":break;default:var i=(t.shiftKey||this.shiftKeyClicked)&&e.shiftKey,n=i?e.shiftKeyLabel:e.el.innerText;t.shiftKey?this.field.value+=n.toUpperCase():this.field.value+=n}}}])&&a(t.prototype,i),n&&a(t,n),e}(),r=[[{key:{ru:"ё",en:"`"},code:"Backquote"},{key:"1",shiftKey:"!",code:"Digit1"},{key:"2",shiftKey:{ru:'"',en:"@"},code:"Digit2"},{key:"3",shiftKey:{ru:"№",en:"#"},code:"Digit3"},{key:"4",shiftKey:{ru:";",en:"$"},code:"Digit4"},{key:"5",shiftKey:"%",code:"Digit5"},{key:"6",shiftKey:{ru:":",en:"^"},code:"Digit6"},{key:"7",shiftKey:{ru:"?",en:"&"},code:"Digit7"},{key:"8",shiftKey:"*",code:"Digit8"},{key:"9",shiftKey:"(",code:"Digit9"},{key:"0",shiftKey:")",code:"Digit0"},{key:"-",shiftKey:"_",code:"Minus"},{key:"=",shiftKey:"+",code:"Equal"},{key:"Backspace",code:"Backspace",size:2,isControlKey:!0}],[{key:"Tab",code:"Tab",isControlKey:!0},{key:{ru:"й",en:"q"},code:"KeyQ"},{key:{ru:"ц",en:"w"},code:"KeyW"},{key:{ru:"у",en:"e"},code:"KeyE"},{key:{ru:"к",en:"r"},code:"KeyR"},{key:{ru:"е",en:"t"},code:"KeyT"},{key:{ru:"н",en:"y"},code:"KeyY"},{key:{ru:"г",en:"u"},code:"KeyU"},{key:{ru:"ш",en:"i"},code:"KeyI"},{key:{ru:"щ",en:"o"},code:"KeyO"},{key:{ru:"з",en:"p"},code:"KeyP"},{key:{ru:"х",en:"["},code:"BracketLeft"},{key:{ru:"ъ",en:"]"},code:"BracketRight"},{key:"\\",shiftKey:"/",code:"Backslash"},{key:"Del",code:"Delete",isControlKey:!0}],[{key:"CapsLock",code:"CapsLock",size:2,isControlKey:!0},{key:{ru:"ф",en:"a"},code:"KeyA"},{key:{ru:"ы",en:"s"},code:"KeyS"},{key:{ru:"в",en:"d"},code:"KeyD"},{key:{ru:"а",en:"f"},code:"KeyF"},{key:{ru:"п",en:"g"},code:"KeyG"},{key:{ru:"р",en:"h"},code:"KeyH"},{key:{ru:"о",en:"j"},code:"KeyJ"},{key:{ru:"л",en:"k"},code:"KeyK"},{key:{ru:"д",en:"l"},code:"KeyL"},{key:{ru:"ж",en:";"},code:"Semicolon"},{key:{ru:"э",en:"'"},code:"Quote"},{key:"Enter",code:"Enter",size:2,isControlKey:!0}],[{key:"Shift",code:"ShiftLeft",size:"2-half",isControlKey:!0},{key:{ru:"я",en:"z"},code:"KeyZ"},{key:{ru:"ч",en:"x"},code:"KeyX"},{key:{ru:"с",en:"c"},code:"KeyC"},{key:{ru:"м",en:"v"},code:"KeyV"},{key:{ru:"и",en:"b"},code:"KeyB"},{key:{ru:"т",en:"n"},code:"KeyN"},{key:{ru:"ь",en:"m"},code:"KeyM"},{key:{ru:"б",en:","},code:"Comma"},{key:{ru:"ю",en:"."},code:"Period"},{key:{ru:".",en:"/"},code:"Slash"},{key:"Shift",code:"ShiftRight",size:"2-half",isControlKey:!0}],[{key:"Ctrl",code:"ControlLeft",size:"1-half",isControlKey:!0},{key:"Win",code:"MetaLeft",size:"1-half",isControlKey:!0},{key:"Alt",code:"AltLeft",size:"1-half",isControlKey:!0},{key:"",code:"Space",size:6},{key:"Alt",code:"AltRight",size:"1-half",isControlKey:!0},{key:"Win",code:"MetaRight",size:"1-half",isControlKey:!0},{key:"Ctrl",code:"ControlRight",size:"1-half",isControlKey:!0}]];document.addEventListener("DOMContentLoaded",(function(){new s(r).init()}))},function(e,t){}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL0tleS5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvS2V5Ym9hcmQuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiS2V5IiwibGFuZ3VhZ2UiLCJjb2RlIiwic2hpZnRLZXkiLCJzaXplIiwiaXNDb250cm9sS2V5IiwidGhpcyIsImVsIiwiaXNVcHBlckNhc2UiLCJpbml0IiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NOYW1lIiwiY2xhc3NMaXN0IiwiYWRkIiwiZGF0YXNldCIsInJlbmRlciIsInNoaWZ0S2V5TGFiZWwiLCJpbm5lclRleHQiLCJsYWJlbCIsInNldFRpbWVvdXQiLCJyZW1vdmUiLCJsYW5nIiwicnUiLCJlbiIsInRvVXBwZXJDYXNlIiwiS2V5Ym9hcmQiLCJrZXlib2FyZFRlbXBsYXRlIiwiYWx0S2V5Q2xpY2tlZCIsInNoaWZ0S2V5Q2xpY2tlZCIsImZpZWxkIiwia2V5cyIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzZXRJdGVtIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJmaW5kIiwiaXRlbSIsInRhcmdldCIsImNoYW5nZUxhbmd1YWdlIiwidG9nZ2xlQ2Fwc0xvY2siLCJ0cmlnZ2VyS2V5IiwiZGlzYWJsZWQiLCJib2R5IiwiYXBwZW5kIiwiZm9yRWFjaCIsInJvdyIsInJvd0luZGV4IiwicHVzaCIsInNldExhbmd1YWdlIiwidG9nZ2xlQ2FzZSIsImJsdXIiLCJzZXRBY3RpdmUiLCJzbGljZSIsImhhc1NoaWZ0S2V5Il0sIm1hcHBpbmdzIjoiYUFDRSxJQUFJQSxFQUFtQixHQUd2QixTQUFTQyxFQUFvQkMsR0FHNUIsR0FBR0YsRUFBaUJFLEdBQ25CLE9BQU9GLEVBQWlCRSxHQUFVQyxRQUduQyxJQUFJQyxFQUFTSixFQUFpQkUsR0FBWSxDQUN6Q0csRUFBR0gsRUFDSEksR0FBRyxFQUNISCxRQUFTLElBVVYsT0FOQUksRUFBUUwsR0FBVU0sS0FBS0osRUFBT0QsUUFBU0MsRUFBUUEsRUFBT0QsUUFBU0YsR0FHL0RHLEVBQU9FLEdBQUksRUFHSkYsRUFBT0QsUUFLZkYsRUFBb0JRLEVBQUlGLEVBR3hCTixFQUFvQlMsRUFBSVYsRUFHeEJDLEVBQW9CVSxFQUFJLFNBQVNSLEVBQVNTLEVBQU1DLEdBQzNDWixFQUFvQmEsRUFBRVgsRUFBU1MsSUFDbENHLE9BQU9DLGVBQWViLEVBQVNTLEVBQU0sQ0FBRUssWUFBWSxFQUFNQyxJQUFLTCxLQUtoRVosRUFBb0JrQixFQUFJLFNBQVNoQixHQUNYLG9CQUFYaUIsUUFBMEJBLE9BQU9DLGFBQzFDTixPQUFPQyxlQUFlYixFQUFTaUIsT0FBT0MsWUFBYSxDQUFFQyxNQUFPLFdBRTdEUCxPQUFPQyxlQUFlYixFQUFTLGFBQWMsQ0FBRW1CLE9BQU8sS0FRdkRyQixFQUFvQnNCLEVBQUksU0FBU0QsRUFBT0UsR0FFdkMsR0FEVSxFQUFQQSxJQUFVRixFQUFRckIsRUFBb0JxQixJQUMvQixFQUFQRSxFQUFVLE9BQU9GLEVBQ3BCLEdBQVcsRUFBUEUsR0FBOEIsaUJBQVZGLEdBQXNCQSxHQUFTQSxFQUFNRyxXQUFZLE9BQU9ILEVBQ2hGLElBQUlJLEVBQUtYLE9BQU9ZLE9BQU8sTUFHdkIsR0FGQTFC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VUMsY0FBYyxHQUU3RCxDQUFFZCxJQUFLLEdBQUlXLEtBQU0sUUFBU0UsS0FBTSxHQUNoQyxDQUNFYixJQUFLLE1BQU9XLEtBQU0sV0FBWUUsS0FBTSxTQUFVQyxjQUFjLEdBRTlELENBQ0VkLElBQUssTUFBT1csS0FBTSxZQUFhRSxLQUFNLFNBQVVDLGNBQWMsR0FFL0QsQ0FDRWQsSUFBSyxPQUFRVyxLQUFNLGVBQWdCRSxLQUFNLFNBQVVDLGNBQWMsS0FLdkVLLFNBQVN5QixpQkFBaUIsb0JBQW9CLFdBQzVDLElBQUlULEVBQVNDLEdBQWtCbEIsVyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgS2V5IHtcbiAgY29uc3RydWN0b3Ioe1xuICAgIGtleSwgY29kZSwgc2hpZnRLZXkgPSBudWxsLCBzaXplID0gbnVsbCwgaXNDb250cm9sS2V5ID0gZmFsc2UsXG4gIH0sIGxhbmd1YWdlKSB7XG4gICAgdGhpcy5lbCA9IG51bGw7XG4gICAgdGhpcy5rZXkgPSBrZXk7XG4gICAgdGhpcy5jb2RlID0gY29kZTtcbiAgICB0aGlzLnNoaWZ0S2V5ID0gc2hpZnRLZXk7XG4gICAgdGhpcy5zaXplID0gc2l6ZTtcbiAgICB0aGlzLmlzQ29udHJvbEtleSA9IGlzQ29udHJvbEtleTtcbiAgICB0aGlzLmxhbmd1YWdlID0gbGFuZ3VhZ2U7XG4gICAgdGhpcy5pc1VwcGVyQ2FzZSA9IGZhbHNlO1xuXG4gICAgdGhpcy5pbml0KCk7XG4gIH1cblxuICBnZXQgbGFiZWwoKSB7XG4gICAgY29uc3QgbGFiZWwgPSAodGhpcy5rZXkucnUgJiYgdGhpcy5rZXkuZW4pID8gdGhpcy5rZXlbdGhpcy5sYW5ndWFnZV0gOiB0aGlzLmtleTtcbiAgICByZXR1cm4gKHRoaXMuaXNVcHBlckNhc2UgJiYgIXRoaXMuaXNDb250cm9sS2V5KSA/IGxhYmVsLnRvVXBwZXJDYXNlKCkgOiBsYWJlbDtcbiAgfVxuXG4gIGdldCBzaGlmdEtleUxhYmVsKCkge1xuICAgIHJldHVybiAodGhpcy5zaGlmdEtleS5ydSAmJiB0aGlzLnNoaWZ0S2V5LmVuKSA/IHRoaXMuc2hpZnRLZXlbdGhpcy5sYW5ndWFnZV0gOiB0aGlzLnNoaWZ0S2V5O1xuICB9XG5cbiAgaW5pdCgpIHtcbiAgICB0aGlzLmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgdGhpcy5lbC5jbGFzc05hbWUgPSAna2V5JztcblxuICAgIGlmICh0aGlzLnNpemUpIHtcbiAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LmFkZChga2V5X3NpemVfJHt0aGlzLnNpemV9YCk7XG4gICAgfVxuXG4gICAgdGhpcy5lbC5kYXRhc2V0LmNvZGUgPSB0aGlzLmNvZGU7XG5cbiAgICB0aGlzLnJlbmRlcigpO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGlmICh0aGlzLnNoaWZ0S2V5KSB7XG4gICAgICB0aGlzLmVsLmRhdGFzZXQuc2hpZnRLZXkgPSB0aGlzLnNoaWZ0S2V5TGFiZWw7XG4gICAgfVxuICAgIHRoaXMuZWwuaW5uZXJUZXh0ID0gdGhpcy5sYWJlbDtcbiAgfVxuXG4gIHNldEFjdGl2ZSgpIHtcbiAgICB0aGlzLmVsLmNsYXNzTGlzdC5hZGQoJ2tleV9hY3RpdmUnKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LnJlbW92ZSgna2V5X2FjdGl2ZScpO1xuICAgIH0sIDMwMCk7XG4gIH1cblxuICBzZXRMYW5ndWFnZShsYW5nKSB7XG4gICAgdGhpcy5sYW5ndWFnZSA9IGxhbmc7XG4gICAgdGhpcy5yZW5kZXIoKTtcbiAgfVxuXG4gIHRvZ2dsZUNhc2UoKSB7XG4gICAgdGhpcy5pc1VwcGVyQ2FzZSA9ICF0aGlzLmlzVXBwZXJDYXNlO1xuICAgIHRoaXMucmVuZGVyKCk7XG4gIH1cbn1cbiIsImltcG9ydCBLZXkgZnJvbSAnLi9LZXknO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBLZXlib2FyZCB7XG4gIGNvbnN0cnVjdG9yKGtleWJvYXJkVGVtcGxhdGUpIHtcbiAgICB0aGlzLmxhbmd1YWdlID0gJ3J1JztcbiAgICB0aGlzLmFsdEtleUNsaWNrZWQgPSBmYWxzZTtcbiAgICB0aGlzLnNoaWZ0S2V5Q2xpY2tlZCA9IGZhbHNlO1xuICAgIHRoaXMua2V5Ym9hcmRUZW1wbGF0ZSA9IGtleWJvYXJkVGVtcGxhdGU7XG4gICAgdGhpcy5lbCA9IG51bGw7XG4gICAgdGhpcy5maWVsZCA9IG51bGw7XG4gICAgdGhpcy5rZXlzID0gW107XG4gIH1cblxuICBpbml0KCkge1xuICAgIC8vIExvYWQgbGFuZ3VhZ2UgZnJvbSBsb2NhbHN0b3JhZ2Ugb3Igc2F2ZSBkZWZhdWx0IGxhbmd1YWdlXG4gICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsYW5ndWFnZScpKSB7XG4gICAgICB0aGlzLmxhbmd1YWdlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xhbmd1YWdlJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdsYW5ndWFnZScsIHRoaXMubGFuZ3VhZ2UpO1xuICAgIH1cblxuICAgIHRoaXMucmVuZGVyKCk7XG5cbiAgICAvLyBPbiBjbGljayB2aXJ0dWFsIGtleVxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgIGNvbnN0IGtleSA9IHRoaXMua2V5cy5maW5kKChpdGVtKSA9PiBpdGVtLmVsID09PSBlLnRhcmdldCk7XG4gICAgICBpZiAoa2V5KSB7XG4gICAgICAgIGlmIChrZXkua2V5ID09PSAnU2hpZnQnKSB7XG4gICAgICAgICAgLy8gQ2hhbmdlIGxhbmd1YWdlIG9uIGNsaWNrIG9uIHZpcnR1YWwga2V5Ym9hcmRcbiAgICAgICAgICBpZiAodGhpcy5hbHRLZXlDbGlja2VkKSB7XG4gICAgICAgICAgICB0aGlzLmNoYW5nZUxhbmd1YWdlKCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gQ2hhbmdlIGxldHRlciBjYXNlIG9uIGNsaWNrICdTaGlmdCcga2V5XG4gICAgICAgICAgdGhpcy5zaGlmdEtleUNsaWNrZWQgPSAhdGhpcy5zaGlmdEtleUNsaWNrZWQ7XG4gICAgICAgICAgdGhpcy50b2dnbGVDYXBzTG9jaygpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50cmlnZ2VyS2V5KGtleSwgZSk7XG5cbiAgICAgICAgaWYgKGtleS5rZXkgIT09ICdBbHQnICYmIHRoaXMuYWx0S2V5Q2xpY2tlZCkge1xuICAgICAgICAgIHRoaXMuYWx0S2V5Q2xpY2tlZCA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGtleS5rZXkgIT09ICdTaGlmdCcgJiYgdGhpcy5zaGlmdEtleUNsaWNrZWQpIHtcbiAgICAgICAgICB0aGlzLnNoaWZ0S2V5Q2xpY2tlZCA9IGZhbHNlO1xuICAgICAgICAgIHRoaXMudG9nZ2xlQ2Fwc0xvY2soKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gT24gcHJlc3MgZGV2aWNlIGtleVxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgKGUpID0+IHtcbiAgICAgIGNvbnN0IGtleSA9IHRoaXMua2V5cy5maW5kKChpdGVtKSA9PiBpdGVtLmNvZGUgPT09IGUuY29kZSk7XG4gICAgICBpZiAoa2V5KSB7XG4gICAgICAgIHRoaXMudHJpZ2dlcktleShrZXksIGUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIC8vIENyZWF0ZSBmaWVsZFxuICAgIHRoaXMuZmllbGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpO1xuICAgIHRoaXMuZmllbGQuY2xhc3NOYW1lID0gJ2ZpZWxkJztcbiAgICB0aGlzLmZpZWxkLmRpc2FibGVkID0gJ2Rpc2FibGVkJztcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZCh0aGlzLmZpZWxkKTtcblxuICAgIC8vIENyZWF0ZSBrZXlib2FyZFxuICAgIHRoaXMuZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0aGlzLmVsLmNsYXNzTmFtZSA9ICdrZXlib2FyZCc7XG5cbiAgICAvLyBDcmVhdGUga2V5Ym9hcmQga2V5c1xuICAgIHRoaXMua2V5Ym9hcmRUZW1wbGF0ZS5mb3JFYWNoKChyb3csIHJvd0luZGV4KSA9PiB7XG4gICAgICByb3cuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBjb25zdCBrZXkgPSBuZXcgS2V5KGl0ZW0sIHRoaXMubGFuZ3VhZ2UpO1xuICAgICAgICBrZXkuZWwuY2xhc3NMaXN0LmFkZChga2V5X3Jvd18ke3Jvd0luZGV4ICsgMX1gKTtcblxuICAgICAgICB0aGlzLmVsLmFwcGVuZChrZXkuZWwpO1xuICAgICAgICB0aGlzLmtleXMucHVzaChrZXkpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZCh0aGlzLmVsKTtcbiAgfVxuXG4gIGNoYW5nZUxhbmd1YWdlKCkge1xuICAgIHRoaXMubGFuZ3VhZ2UgPSAodGhpcy5sYW5ndWFnZSA9PT0gJ3J1JykgPyAnZW4nIDogJ3J1JztcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnbGFuZ3VhZ2UnLCB0aGlzLmxhbmd1YWdlKTtcbiAgICB0aGlzLmtleXMuZm9yRWFjaCgoaXRlbSkgPT4gaXRlbS5zZXRMYW5ndWFnZSh0aGlzLmxhbmd1YWdlKSk7XG4gIH1cblxuICB0b2dnbGVDYXBzTG9jaygpIHtcbiAgICB0aGlzLmtleXMuZm9yRWFjaCgoaXRlbSkgPT4gaXRlbS50b2dnbGVDYXNlKCkpO1xuICB9XG5cbiAgdHJpZ2dlcktleShrZXksIGUgPSBudWxsKSB7XG4gICAgdGhpcy5maWVsZC5ibHVyKCk7XG4gICAga2V5LnNldEFjdGl2ZSgpO1xuXG4gICAgc3dpdGNoIChrZXkuY29kZSkge1xuICAgICAgY2FzZSAnQmFja3NwYWNlJzpcbiAgICAgICAgdGhpcy5maWVsZC52YWx1ZSA9IHRoaXMuZmllbGQudmFsdWUuc2xpY2UoMCwgLTEpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnQ2Fwc0xvY2snOlxuICAgICAgICB0aGlzLnRvZ2dsZUNhcHNMb2NrKCk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdFbnRlcic6XG4gICAgICAgIHRoaXMuZmllbGQudmFsdWUgKz0gJ1xcbic7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdTcGFjZSc6XG4gICAgICAgIHRoaXMuZmllbGQudmFsdWUgKz0gJyAnO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnQWx0TGVmdCc6XG4gICAgICBjYXNlICdBbHRSaWdodCc6XG4gICAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgdGhpcy5jaGFuZ2VMYW5ndWFnZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuYWx0S2V5Q2xpY2tlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIC8vIFVudXNlZCBrZXlzXG4gICAgICBjYXNlICdUYWInOlxuICAgICAgY2FzZSAnRGVsZXRlJzpcbiAgICAgIGNhc2UgJ01ldGFMZWZ0JzpcbiAgICAgIGNhc2UgJ01ldGFSaWdodCc6XG4gICAgICBjYXNlICdTaGlmdExlZnQnOlxuICAgICAgY2FzZSAnU2hpZnRSaWdodCc6XG4gICAgICBjYXNlICdDb250cm9sTGVmdCc6XG4gICAgICBjYXNlICdDb250cm9sUmlnaHQnOlxuICAgICAgICBicmVhaztcblxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICAvLyBJZiBrZXkgaGFzIHNoaWZ0S2V5IC0gbGlrZSBhICcxJyB3aGVuIHNoaWZ0IHByZXNzZWQgYmUgJyEnLCAyIC0gQCwgZXRjXG4gICAgICAgIGNvbnN0IGhhc1NoaWZ0S2V5ID0gKGUuc2hpZnRLZXkgfHwgdGhpcy5zaGlmdEtleUNsaWNrZWQpICYmIGtleS5zaGlmdEtleTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSAoaGFzU2hpZnRLZXkpID8ga2V5LnNoaWZ0S2V5TGFiZWwgOiBrZXkuZWwuaW5uZXJUZXh0O1xuXG4gICAgICAgIC8vIElmIHByZXNzZWQgJ1NoaWZ0JyBrZXkgb24gcGh5c2ljYWwga2V5Ym9hcmRcbiAgICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcbiAgICAgICAgICB0aGlzLmZpZWxkLnZhbHVlICs9IGxhYmVsLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5maWVsZC52YWx1ZSArPSBsYWJlbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIiwiaW1wb3J0ICcuL3N0eWxlcy9tYWluLnNjc3MnO1xuaW1wb3J0IEtleWJvYXJkIGZyb20gJy4vS2V5Ym9hcmQnO1xuXG5jb25zdCBrZXlib2FyZFRlbXBsYXRlID0gW1xuICBbXG4gICAgeyBrZXk6IHsgcnU6ICfRkScsIGVuOiAnYCcgfSwgY29kZTogJ0JhY2txdW90ZScgfSxcbiAgICB7IGtleTogJzEnLCBzaGlmdEtleTogJyEnLCBjb2RlOiAnRGlnaXQxJyB9LFxuICAgIHsga2V5OiAnMicsIHNoaWZ0S2V5OiB7IHJ1OiAnXCInLCBlbjogJ0AnIH0sIGNvZGU6ICdEaWdpdDInIH0sXG4gICAgeyBrZXk6ICczJywgc2hpZnRLZXk6IHsgcnU6ICfihJYnLCBlbjogJyMnIH0sIGNvZGU6ICdEaWdpdDMnIH0sXG4gICAgeyBrZXk6ICc0Jywgc2hpZnRLZXk6IHsgcnU6ICc7JywgZW46ICckJyB9LCBjb2RlOiAnRGlnaXQ0JyB9LFxuICAgIHsga2V5OiAnNScsIHNoaWZ0S2V5OiAnJScsIGNvZGU6ICdEaWdpdDUnIH0sXG4gICAgeyBrZXk6ICc2Jywgc2hpZnRLZXk6IHsgcnU6ICc6JywgZW46ICdeJyB9LCBjb2RlOiAnRGlnaXQ2JyB9LFxuICAgIHsga2V5OiAnNycsIHNoaWZ0S2V5OiB7IHJ1OiAnPycsIGVuOiAnJicgfSwgY29kZTogJ0RpZ2l0NycgfSxcbiAgICB7IGtleTogJzgnLCBzaGlmdEtleTogJyonLCBjb2RlOiAnRGlnaXQ4JyB9LFxuICAgIHsga2V5OiAnOScsIHNoaWZ0S2V5OiAnKCcsIGNvZGU6ICdEaWdpdDknIH0sXG4gICAgeyBrZXk6ICcwJywgc2hpZnRLZXk6ICcpJywgY29kZTogJ0RpZ2l0MCcgfSxcbiAgICB7IGtleTogJy0nLCBzaGlmdEtleTogJ18nLCBjb2RlOiAnTWludXMnIH0sXG4gICAgeyBrZXk6ICc9Jywgc2hpZnRLZXk6ICcrJywgY29kZTogJ0VxdWFsJyB9LFxuICAgIHtcbiAgICAgIGtleTogJ0JhY2tzcGFjZScsIGNvZGU6ICdCYWNrc3BhY2UnLCBzaXplOiAyLCBpc0NvbnRyb2xLZXk6IHRydWUsXG4gICAgfSxcbiAgXSxcbiAgW1xuICAgIHsga2V5OiAnVGFiJywgY29kZTogJ1RhYicsIGlzQ29udHJvbEtleTogdHJ1ZSB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0LknLCBlbjogJ3EnIH0sIGNvZGU6ICdLZXlRJyB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0YYnLCBlbjogJ3cnIH0sIGNvZGU6ICdLZXlXJyB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0YMnLCBlbjogJ2UnIH0sIGNvZGU6ICdLZXlFJyB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0LonLCBlbjogJ3InIH0sIGNvZGU6ICdLZXlSJyB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0LUnLCBlbjogJ3QnIH0sIGNvZGU6ICdLZXlUJyB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0L0nLCBlbjogJ3knIH0sIGNvZGU6ICdLZXlZJyB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0LMnLCBlbjogJ3UnIH0sIGNvZGU6ICdLZXlVJyB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0YgnLCBlbjogJ2knIH0sIGNvZGU6ICdLZXlJJyB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0YknLCBlbjogJ28nIH0sIGNvZGU6ICdLZXlPJyB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0LcnLCBlbjogJ3AnIH0sIGNvZGU6ICdLZXlQJyB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0YUnLCBlbjogJ1snIH0sIGNvZGU6ICdCcmFja2V0TGVmdCcgfSxcbiAgICB7IGtleTogeyBydTogJ9GKJywgZW46ICddJyB9LCBjb2RlOiAnQnJhY2tldFJpZ2h0JyB9LFxuICAgIHsga2V5OiAnXFxcXCcsIHNoaWZ0S2V5OiAnLycsIGNvZGU6ICdCYWNrc2xhc2gnIH0sXG4gICAgeyBrZXk6ICdEZWwnLCBjb2RlOiAnRGVsZXRlJywgaXNDb250cm9sS2V5OiB0cnVlIH0sXG4gIF0sXG4gIFtcbiAgICB7XG4gICAgICBrZXk6ICdDYXBzTG9jaycsIGNvZGU6ICdDYXBzTG9jaycsIHNpemU6IDIsIGlzQ29udHJvbEtleTogdHJ1ZSxcbiAgICB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0YQnLCBlbjogJ2EnIH0sIGNvZGU6ICdLZXlBJyB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0YsnLCBlbjogJ3MnIH0sIGNvZGU6ICdLZXlTJyB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0LInLCBlbjogJ2QnIH0sIGNvZGU6ICdLZXlEJyB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0LAnLCBlbjogJ2YnIH0sIGNvZGU6ICdLZXlGJyB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0L8nLCBlbjogJ2cnIH0sIGNvZGU6ICdLZXlHJyB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0YAnLCBlbjogJ2gnIH0sIGNvZGU6ICdLZXlIJyB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0L4nLCBlbjogJ2onIH0sIGNvZGU6ICdLZXlKJyB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0LsnLCBlbjogJ2snIH0sIGNvZGU6ICdLZXlLJyB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0LQnLCBlbjogJ2wnIH0sIGNvZGU6ICdLZXlMJyB9LFxuICAgIHsga2V5OiB7IHJ1OiAn0LYnLCBlbjogJzsnIH0sIGNvZGU6ICdTZW1pY29sb24nIH0sXG4gICAgeyBrZXk6IHsgcnU6ICfRjScsIGVuOiAnXFwnJyB9LCBjb2RlOiAnUXVvdGUnIH0sXG4gICAge1xuICAgICAga2V5OiAnRW50ZXInLCBjb2RlOiAnRW50ZXInLCBzaXplOiAyLCBpc0NvbnRyb2xLZXk6IHRydWUsXG4gICAgfSxcbiAgXSxcbiAgW1xuICAgIHtcbiAgICAgIGtleTogJ1NoaWZ0JywgY29kZTogJ1NoaWZ0TGVmdCcsIHNpemU6ICcyLWhhbGYnLCBpc0NvbnRyb2xLZXk6IHRydWUsXG4gICAgfSxcbiAgICB7IGtleTogeyBydTogJ9GPJywgZW46ICd6JyB9LCBjb2RlOiAnS2V5WicgfSxcbiAgICB7IGtleTogeyBydTogJ9GHJywgZW46ICd4JyB9LCBjb2RlOiAnS2V5WCcgfSxcbiAgICB7IGtleTogeyBydTogJ9GBJywgZW46ICdjJyB9LCBjb2RlOiAnS2V5QycgfSxcbiAgICB7IGtleTogeyBydTogJ9C8JywgZW46ICd2JyB9LCBjb2RlOiAnS2V5VicgfSxcbiAgICB7IGtleTogeyBydTogJ9C4JywgZW46ICdiJyB9LCBjb2RlOiAnS2V5QicgfSxcbiAgICB7IGtleTogeyBydTogJ9GCJywgZW46ICduJyB9LCBjb2RlOiAnS2V5TicgfSxcbiAgICB7IGtleTogeyBydTogJ9GMJywgZW46ICdtJyB9LCBjb2RlOiAnS2V5TScgfSxcbiAgICB7IGtleTogeyBydTogJ9CxJywgZW46ICcsJyB9LCBjb2RlOiAnQ29tbWEnIH0sXG4gICAgeyBrZXk6IHsgcnU6ICfRjicsIGVuOiAnLicgfSwgY29kZTogJ1BlcmlvZCcgfSxcbiAgICB7IGtleTogeyBydTogJy4nLCBlbjogJy8nIH0sIGNvZGU6ICdTbGFzaCcgfSxcbiAgICB7XG4gICAgICBrZXk6ICdTaGlmdCcsIGNvZGU6ICdTaGlmdFJpZ2h0Jywgc2l6ZTogJzItaGFsZicsIGlzQ29udHJvbEtleTogdHJ1ZSxcbiAgICB9LFxuICBdLFxuICBbXG4gICAge1xuICAgICAga2V5OiAnQ3RybCcsIGNvZGU6ICdDb250cm9sTGVmdCcsIHNpemU6ICcxLWhhbGYnLCBpc0NvbnRyb2xLZXk6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBrZXk6ICdXaW4nLCBjb2RlOiAnTWV0YUxlZnQnLCBzaXplOiAnMS1oYWxmJywgaXNDb250cm9sS2V5OiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAga2V5OiAnQWx0JywgY29kZTogJ0FsdExlZnQnLCBzaXplOiAnMS1oYWxmJywgaXNDb250cm9sS2V5OiB0cnVlLFxuICAgIH0sXG4gICAgeyBrZXk6ICcnLCBjb2RlOiAnU3BhY2UnLCBzaXplOiA2IH0sXG4gICAge1xuICAgICAga2V5OiAnQWx0JywgY29kZTogJ0FsdFJpZ2h0Jywgc2l6ZTogJzEtaGFsZicsIGlzQ29udHJvbEtleTogdHJ1ZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogJ1dpbicsIGNvZGU6ICdNZXRhUmlnaHQnLCBzaXplOiAnMS1oYWxmJywgaXNDb250cm9sS2V5OiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAga2V5OiAnQ3RybCcsIGNvZGU6ICdDb250cm9sUmlnaHQnLCBzaXplOiAnMS1oYWxmJywgaXNDb250cm9sS2V5OiB0cnVlLFxuICAgIH0sXG4gIF0sXG5dO1xuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4ge1xuICBuZXcgS2V5Ym9hcmQoa2V5Ym9hcmRUZW1wbGF0ZSkuaW5pdCgpO1xufSk7XG4iXSwic291cmNlUm9vdCI6IiJ9